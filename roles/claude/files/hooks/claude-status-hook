#!/usr/bin/env bash

# Claude Code hook for tmux status integration
# Updates pane-level status files based on Claude's working state

STATUS_DIR="$HOME/.cache/claude-status"
mkdir -p "$STATUS_DIR"

# Read JSON from stdin (required by Claude Code hooks)
cat >/dev/null

# Get pane ID from environment or tmux
PANE_ID="${TMUX_PANE}"
if [ -z "$PANE_ID" ]; then
  PANE_ID=$(tmux display-message -p '#{pane_id}' 2>/dev/null)
fi
[ -z "$PANE_ID" ] && exit 0

# Strip % prefix for filename
PANE_NUM="${PANE_ID#%}"
STATUS_FILE="$STATUS_DIR/pane_${PANE_NUM}.status"

HOOK_TYPE="$1"

case "$HOOK_TYPE" in
"PreToolUse" | "Notification")
  echo "working" >"$STATUS_FILE"
  ;;
"Stop" | "SubagentStop")
  echo "idle" >"$STATUS_FILE"
  ;;
*)
  rm -f "$STATUS_FILE"
  ;;
esac

exit 0
