# Hyprland Configuration
# Inspired by Hammerspoon workflow - translates macOS window management to Wayland
# Replaces F13 modal summons with direct scratchpad toggles

# ========================================
# ENVIRONMENT VARIABLES
# ========================================
$terminal = ghostty

# ========================================
# MONITOR CONFIGURATION
# ========================================
monitor=,preferred,auto,1

# ========================================
# STARTUP APPLICATIONS
# ========================================
exec-once = waybar
exec-once = hyprpaper
exec-once = hypridle

# Auto-launch apps on startup (Hammerspoon style)
# Apps will be positioned by window rules, use F13+key to focus
exec-once = ghostty      # Terminal - Cell 1 (left 65%)
# exec-once = brave      # Browser - Cell 2 (right 35%) - uncomment if you want auto-launch
# exec-once = mattermost # Chat - Cell 3 (top-right float)
# exec-once = spotify    # Music - Cell 4 (center-left float)
# Add any other apps you want to auto-launch here

# ========================================
# INPUT CONFIGURATION
# ========================================
input {
    kb_layout = us
    follow_mouse = 1
    touchpad {
        natural_scroll = false
    }
    sensitivity = 0
    repeat_rate = 50
    repeat_delay = 300
}

# ========================================
# GENERAL SETTINGS
# ========================================
general {
    gaps_in = 5
    gaps_out = 10
    border_size = 2
    # Catppuccin Mocha colors
    col.active_border = rgba(89b4faee) rgba(cba6f7ee) 45deg
    col.inactive_border = rgba(313244aa)
    layout = master  # Changed from dwindle to master for more predictable positioning
}

# ========================================
# WINDOW DECORATIONS
# ========================================
decoration {
    rounding = 10

    blur {
        enabled = true
        size = 5
        passes = 2
        new_optimizations = true
    }

    shadow {
        enabled = true
        range = 8
        render_power = 3
        color = rgba(1a1a1aee)
    }
}

# ========================================
# ANIMATIONS
# ========================================
animations {
    enabled = true
    bezier = smoothOut, 0.36, 0, 0.66, -0.56
    bezier = smoothIn, 0.25, 1, 0.5, 1
    bezier = overshot, 0.05, 0.9, 0.1, 1.1

    animation = windows, 1, 5, overshot, slide
    animation = windowsOut, 1, 4, smoothOut, slide
    animation = border, 1, 10, default
    animation = fade, 1, 8, smoothIn
    animation = workspaces, 1, 6, default
    animation = specialWorkspace, 1, 4, overshot, slidevert
}

# ========================================
# LAYOUTS
# ========================================
# Master layout for Hammerspoon-style fixed positioning
master {
    new_on_top = false
    new_status = master  # New windows become master (like terminal on left)
    mfact = 0.65         # Master takes 65% (matches terminal left_large)
    orientation = left   # Master on left, stack on right
}

dwindle {
    pseudotile = true
    preserve_split = true
    force_split = 2  # New windows split to the right/bottom
}

# ========================================
# CELL-BASED WINDOW MANAGEMENT SYSTEM
# ========================================
# Auto-generated window rules (definitions.conf is for bash scripts only)
source = ~/.config/hypr/cells/window-rules.conf

# ========================================
# WINDOW RULES - HAMMERSPOON 4K LAYOUT
# ========================================
# Grid: 80x40 cells (matches Hammerspoon)
# Layout recreates your exact macOS Hammerspoon positions
# Note: window-rules.conf is auto-generated from cell assignments

# ----------------------------------------
# CELL 1: Terminal (left_large)
# Position: 0,0 52x40 → LEFT 65%
# ----------------------------------------
windowrulev2 = float, class:^(com\.mitchellh\.ghostty)$
windowrulev2 = size 65% 100%, class:^(com\.mitchellh\.ghostty)$
windowrulev2 = move 0% 0%, class:^(com\.mitchellh\.ghostty)$

windowrulev2 = float, class:^(kitty)$
windowrulev2 = size 65% 100%, class:^(kitty)$
windowrulev2 = move 0% 0%, class:^(kitty)$

windowrulev2 = float, class:^(Alacritty)$
windowrulev2 = size 65% 100%, class:^(Alacritty)$
windowrulev2 = move 0% 0%, class:^(Alacritty)$

# ----------------------------------------
# CELL 2: Browser (right_side)
# Position: 52,0 28x40 → RIGHT 35%
# ----------------------------------------
windowrulev2 = float, class:^(brave-browser)$
windowrulev2 = size 35% 100%, class:^(brave-browser)$
windowrulev2 = move 65% 0%, class:^(brave-browser)$

windowrulev2 = float, class:^(firefox)$
windowrulev2 = size 35% 100%, class:^(firefox)$
windowrulev2 = move 65% 0%, class:^(firefox)$

windowrulev2 = float, class:^(chromium)$
windowrulev2 = size 35% 100%, class:^(chromium)$
windowrulev2 = move 65% 0%, class:^(chromium)$

# ----------------------------------------
# CELL 3: MatterMost/Discord/Obsidian (top_right)
# Position: 50,2 28x20 → TOP-RIGHT FLOATING (62.5% x, 5% y, 35% w, 50% h)
# ----------------------------------------
windowrulev2 = float, class:^(Mattermost)$
windowrulev2 = size 35% 50%, class:^(Mattermost)$
windowrulev2 = move 62.5% 5%, class:^(Mattermost)$

windowrulev2 = float, class:^(discord)$
windowrulev2 = size 35% 50%, class:^(discord)$
windowrulev2 = move 62.5% 5%, class:^(discord)$

windowrulev2 = float, class:^(obsidian)$
windowrulev2 = size 35% 50%, class:^(obsidian)$
windowrulev2 = move 62.5% 5%, class:^(obsidian)$

# ----------------------------------------
# CELL 4: Spotify/Outlook/Finder/1Password (center_left_large)
# Position: 6,5 44x30 → CENTER-LEFT FLOAT (7.5% x, 12.5% y, 55% w, 75% h)
# Behind terminal - accessible via summon
# ----------------------------------------
windowrulev2 = float, class:^(Spotify)$
windowrulev2 = size 55% 75%, class:^(Spotify)$
windowrulev2 = move 7.5% 12.5%, class:^(Spotify)$
windowrulev2 = float, class:^(spotify)$
windowrulev2 = size 55% 75%, class:^(spotify)$
windowrulev2 = move 7.5% 12.5%, class:^(spotify)$

windowrulev2 = float, title:^(Outlook)$
windowrulev2 = size 55% 75%, title:^(Outlook)$
windowrulev2 = move 7.5% 12.5%, title:^(Outlook)$

windowrulev2 = float, class:^(thunar)$
windowrulev2 = size 55% 75%, class:^(thunar)$
windowrulev2 = move 7.5% 12.5%, class:^(thunar)$
windowrulev2 = float, class:^(Thunar)$
windowrulev2 = size 55% 75%, class:^(Thunar)$
windowrulev2 = move 7.5% 12.5%, class:^(Thunar)$

windowrulev2 = float, class:^(1Password)$
windowrulev2 = size 55% 75%, class:^(1Password)$
windowrulev2 = move 7.5% 12.5%, class:^(1Password)$

# ----------------------------------------
# CELL 5: Teams (center_large)
# Position: 10,5 60x30 → LARGE CENTERED (12.5% x, 12.5% y, 75% w, 75% h)
# ----------------------------------------
windowrulev2 = float, class:^(teams)$
windowrulev2 = size 75% 75%, class:^(teams)$
windowrulev2 = move 12.5% 12.5%, class:^(teams)$
windowrulev2 = float, class:^(Microsoft Teams)$
windowrulev2 = size 75% 75%, class:^(Microsoft Teams)$
windowrulev2 = move 12.5% 12.5%, class:^(Microsoft Teams)$

# ----------------------------------------
# CELL 6: Claude/Agenda (right_small)
# Position: 48,8 30x24 → SMALL RIGHT POPUP (60% x, 20% y, 37.5% w, 60% h)
# ----------------------------------------
windowrulev2 = float, class:^(claude)$
windowrulev2 = size 37.5% 60%, class:^(claude)$
windowrulev2 = move 60% 20%, class:^(claude)$

windowrulev2 = float, class:^(granola)$
windowrulev2 = size 37.5% 60%, class:^(granola)$
windowrulev2 = move 60% 20%, class:^(granola)$

# ========================================
# KEYBINDINGS
# ========================================

# ----------------------------------------
# MODAL BINDINGS (Hammerspoon-style!)
# ----------------------------------------
# Press trigger key, then press a letter key (just like Hammerspoon)
# This creates a modal binding system

# Enter modal mode - F13 key sends XF86Tools on your keyboard
bind = , XF86Tools, submap, f13        # Your actual F13 key!
bind = , code:191, submap, f13         # Backup: raw keycode 191
bind = , F13, submap, f13              # Fallback: symbolic F13
bind = SUPER, Space, submap, f13       # Alternative: Super+Space

# Define F13 submap bindings
submap = f13

# CELL-BASED SUMMON: Focus-or-launch apps in assigned cells
# F13+key focuses existing app or launches if not running
# Uses cell-summon.sh for intelligent cell-based positioning

bind = , t, exec, ~/.config/hypr/scripts/cell-summon.sh com.mitchellh.ghostty ghostty
bind = , t, submap, reset

bind = , b, exec, ~/.config/hypr/scripts/cell-summon.sh brave-browser brave
bind = , b, submap, reset

bind = , c, exec, ~/.config/hypr/scripts/cell-summon.sh Mattermost mattermost
bind = , c, submap, reset

bind = , d, exec, ~/.config/hypr/scripts/cell-summon.sh discord discord
bind = , d, submap, reset

bind = , e, exec, ~/.config/hypr/scripts/cell-summon.sh Outlook outlook
bind = , e, submap, reset

bind = , f, exec, ~/.config/hypr/scripts/cell-summon.sh Thunar thunar
bind = , f, submap, reset

bind = , g, exec, ~/.config/hypr/scripts/cell-summon.sh claude claude
bind = , g, submap, reset

bind = , s, exec, ~/.config/hypr/scripts/cell-summon.sh Spotify spotify
bind = , s, submap, reset

bind = , n, exec, ~/.config/hypr/scripts/cell-summon.sh obsidian obsidian
bind = , n, submap, reset

bind = , o, exec, ~/.config/hypr/scripts/cell-summon.sh 1Password 1password
bind = , o, submap, reset

bind = , m, exec, ~/.config/hypr/scripts/cell-summon.sh "Microsoft Teams" teams
bind = , m, submap, reset

bind = , a, exec, ~/.config/hypr/scripts/cell-summon.sh granola granola
bind = , a, submap, reset

# Cell Management
bind = , v, exec, ~/.config/hypr/scripts/cell-overlay.sh
bind = , v, submap, reset

bind = , r, exec, ~/.config/hypr/scripts/cell-reassign.sh
bind = , r, submap, reset

# App launcher (rofi)
bind = , Return, exec, rofi -show drun
bind = , Return, submap, reset

# Workspaces
bind = , 1, workspace, 1
bind = , 1, submap, reset
bind = , 2, workspace, 2
bind = , 2, submap, reset
bind = , 3, workspace, 3
bind = , 3, submap, reset
bind = , 4, workspace, 4
bind = , 4, submap, reset
bind = , 5, workspace, 5
bind = , 5, submap, reset
bind = , 6, workspace, 6
bind = , 6, submap, reset
bind = , 7, workspace, 7
bind = , 7, submap, reset
bind = , 8, workspace, 8
bind = , 8, submap, reset
bind = , 9, workspace, 9
bind = , 9, submap, reset

# Escape from F13 mode
bind = , escape, submap, reset
bind = , catchall, submap, reset

# Return to default submap
submap = reset

# ----------------------------------------
# WINDOW MANAGEMENT (Super + vim keys)
# ----------------------------------------
# Vim-like focus movement using Super for ergonomics
bind = SUPER, H, movefocus, l                            # Focus left
bind = SUPER, J, movefocus, d                            # Focus down
bind = SUPER, K, movefocus, u                            # Focus up
bind = SUPER, L, movefocus, r                            # Focus right

# Move windows
bind = SUPER SHIFT, H, movewindow, l
bind = SUPER SHIFT, J, movewindow, d
bind = SUPER SHIFT, K, movewindow, u
bind = SUPER SHIFT, L, movewindow, r

# Resize windows
bind = SUPER CTRL, H, resizeactive, -40 0
bind = SUPER CTRL, J, resizeactive, 0 40
bind = SUPER CTRL, K, resizeactive, 0 -40
bind = SUPER CTRL, L, resizeactive, 40 0

# Window actions
bind = SUPER, Q, killactive,                             # Close window
bind = SUPER, V, togglefloating,                         # Toggle float
bind = SUPER, M, fullscreen, 1                           # Maximize (monocle)
bind = SUPER SHIFT, M, fullscreen, 0                     # True fullscreen
bind = SUPER, P, pseudo,                                 # Pseudotile
bind = SUPER, X, togglesplit,                            # Toggle split direction

# ----------------------------------------
# WORKSPACES (Configured in F13 submap above)
# ----------------------------------------
# Workspace switching via F13+1-9 (see F13 modal section)
# Workspace 1: Development (Terminal + Editor)
# Workspace 2: Communication (Chat, Email)
# Workspace 3: Browser (Research)
# Workspace 4: Meetings (Teams, Zoom)
# Workspace 5: Media (Design, Video)

# ----------------------------------------
# MOUSE BINDINGS
# ----------------------------------------
bindm = SUPER, mouse:272, movewindow
bindm = SUPER, mouse:273, resizewindow

# ----------------------------------------
# FUNCTION KEYS & MEDIA
# ----------------------------------------
bind = , XF86AudioRaiseVolume, exec, wpctl set-volume @DEFAULT_AUDIO_SINK@ 5%+
bind = , XF86AudioLowerVolume, exec, wpctl set-volume @DEFAULT_AUDIO_SINK@ 5%-
bind = , XF86AudioMute, exec, wpctl set-mute @DEFAULT_AUDIO_SINK@ toggle
bind = , XF86AudioPlay, exec, playerctl play-pause
bind = , XF86AudioNext, exec, playerctl next
bind = , XF86AudioPrev, exec, playerctl previous

bind = , XF86MonBrightnessUp, exec, brightnessctl set 5%+
bind = , XF86MonBrightnessDown, exec, brightnessctl set 5%-

# ----------------------------------------
# UTILITY BINDINGS
# ----------------------------------------
bind = SUPER SHIFT, S, exec, grim -g "$(slurp)" - | swappy -f -  # Screenshot
bind = SUPER SHIFT, E, exec, rofi -show emoji         # Emoji picker
bind = SUPER, C, exec, hyprlock                       # Lo[c]k screen
bind = SUPER SHIFT, C, exec, hyprlock                 # Lo[c]k screen (alternate)
bind = SUPER SHIFT, X, exit,                          # Exit Hyprland

# Reload waybar
bind = SUPER SHIFT, R, exec, killall waybar && waybar &

# ========================================
# MISC SETTINGS
# ========================================
misc {
    disable_hyprland_logo = true
    disable_splash_rendering = true
    mouse_move_enables_dpms = true
    key_press_enables_dpms = true
    vrr = 1
}
