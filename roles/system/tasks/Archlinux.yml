---
- name: "System | {{ ansible_distribution }} | Update pacman"
  community.general.pacman:
    update_cache: true
    upgrade: true
    state: latest
  become: true
  when: can_install_packages | default(false)

- name: "System | {{ ansible_distribution }} | Install"
  community.general.pacman:
    name:
      - jq
      - open-iscsi
      - unzip
    state: present
  become: true
  when: can_install_packages | default(false)

- name: "System | {{ ansible_distribution }} | Packages skipped (no sudo)"
  ansible.builtin.debug:
    msg:
      - "⚠️  Package installation skipped due to missing sudo privileges"
      - "The following packages would be installed with sudo: jq, open-iscsi, unzip"
      - "Please run with sudo or contact your system administrator"
  when: not (can_install_packages | default(false))
